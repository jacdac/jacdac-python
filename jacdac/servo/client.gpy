from jacdac.bus import Bus, Client
from .constants import *
from typing import Union, cast


class ServoClient(Client):
    """
    Servo is a small motor with arm that can be pointing at a specific direction.
     * 
     * The `min/max_angle/pulse` may be read-only if the servo is permanently affixed to its Jacdac controller.
    """

    def __init__(self, bus: Bus, role: str) -> None:
        super().__init__(bus, JD_SERVICE_CLASS_SERVO, JD_SERVO_PACK_FORMATS, role)
    

    @property
    def angle(self) -> Union[float, None]:
        """
        Specifies the angle of the arm (request)., °
        """
        reg = self.register(JD_SERVO_REG_ANGLE)
        value = reg.value(0)
        return cast(Union[float, None], value)

    @angle.setter
    def angle(self, value: float) -> None:
        self.enabled = True
        reg = self.register(JD_SERVO_REG_ANGLE)
        reg.set_value(0, value)


    @property
    def enabled(self) -> Union[bool, None]:
        """
        Turn the power to the servo on/off.
        """
        reg = self.register(JD_SERVO_REG_ENABLED)
        value = reg.value(0)
        return cast(Union[bool, None], value)

    @enabled.setter
    def enabled(self, value: bool) -> None:
        reg = self.register(JD_SERVO_REG_ENABLED)
        reg.set_value(0, value)


    @property
    def offset(self) -> Union[float, None]:
        """
        Correction applied to the angle to account for the servo arm drift., °
        """
        reg = self.register(JD_SERVO_REG_OFFSET)
        value = reg.value(0)
        return cast(Union[float, None], value)

    @offset.setter
    def offset(self, value: float) -> None:
        reg = self.register(JD_SERVO_REG_OFFSET)
        reg.set_value(0, value)


    @property
    def min_angle(self) -> Union[float, None]:
        """
        Lowest angle that can be set., °
        """
        reg = self.register(JD_SERVO_REG_MIN_ANGLE)
        value = reg.value(0)
        return cast(Union[float, None], value)

    @property
    def min_pulse(self) -> Union[int, None]:
        """
        The length of pulse corresponding to lowest angle., us
        """
        reg = self.register(JD_SERVO_REG_MIN_PULSE)
        value = reg.value(0)
        return cast(Union[int, None], value)

    @min_pulse.setter
    def min_pulse(self, value: int) -> None:
        reg = self.register(JD_SERVO_REG_MIN_PULSE)
        reg.set_value(0, value)


    @property
    def max_angle(self) -> Union[float, None]:
        """
        Highest angle that can be set., °
        """
        reg = self.register(JD_SERVO_REG_MAX_ANGLE)
        value = reg.value(0)
        return cast(Union[float, None], value)

    @property
    def max_pulse(self) -> Union[int, None]:
        """
        The length of pulse corresponding to highest angle., us
        """
        reg = self.register(JD_SERVO_REG_MAX_PULSE)
        value = reg.value(0)
        return cast(Union[int, None], value)

    @max_pulse.setter
    def max_pulse(self, value: int) -> None:
        reg = self.register(JD_SERVO_REG_MAX_PULSE)
        reg.set_value(0, value)


    @property
    def stall_torque(self) -> Union[float, None]:
        """
        (Optional) The servo motor will stop rotating when it is trying to move a ``stall_torque`` weight at a radial distance of ``1.0`` cm., kg/cm
        """
        reg = self.register(JD_SERVO_REG_STALL_TORQUE)
        value = reg.value(0)
        return cast(Union[float, None], value)

    @property
    def response_speed(self) -> Union[float, None]:
        """
        (Optional) Time to move 60°., s/60°
        """
        reg = self.register(JD_SERVO_REG_RESPONSE_SPEED)
        value = reg.value(0)
        return cast(Union[float, None], value)

    @property
    def current_angle(self) -> Union[float, None]:
        """
        (Optional) The current physical position of the arm., °
        """
        reg = self.register(JD_SERVO_REG_CURRENT_ANGLE)
        value = reg.value(0)
        return cast(Union[float, None], value)

    
